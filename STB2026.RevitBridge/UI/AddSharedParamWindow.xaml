<Window x:Class="STB2026.RevitBridge.UI.AddSharedParamWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Добавить параметр ФОП в семейство"
        Width="650" Height="620"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        Background="#F5F5F5">

    <Window.Resources>
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,8,0,4"/>
            <Setter Property="Foreground" Value="#333"/>
        </Style>
        <Style x:Key="ComboStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
        <Style x:Key="InfoStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="Margin" Value="0,2,0,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- 0: Заголовок -->
            <RowDefinition Height="Auto"/>   <!-- 1: Группа ФОП -->
            <RowDefinition Height="Auto"/>   <!-- 2: Параметр ФОП -->
            <RowDefinition Height="Auto"/>   <!-- 3: Инфо -->
            <RowDefinition Height="Auto"/>   <!-- 4: Привязка + Группа отображения -->
            <RowDefinition Height="Auto"/>   <!-- 5: Категория + "Вся категория" -->
            <RowDefinition Height="*"/>      <!-- 6: Список семейств -->
            <RowDefinition Height="Auto"/>   <!-- 7: Связать с -->
            <RowDefinition Height="Auto"/>   <!-- 8: Кнопки -->
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <StackPanel Grid.Row="0" Margin="0,0,0,8">
            <TextBlock Text="Добавление общего параметра в семейство"
                       FontSize="15" FontWeight="Bold" Foreground="#1a1a2e"/>
            <TextBlock Text="Параметр из ФОП будет добавлен в выбранные семейства через редактор"
                       FontSize="11" Foreground="#888" Margin="0,4,0,0"/>
        </StackPanel>

        <!-- Группа ФОП -->
        <StackPanel Grid.Row="1">
            <TextBlock Text="Группа ФОП" Style="{StaticResource LabelStyle}"/>
            <ComboBox x:Name="cmbSpfGroup" Style="{StaticResource ComboStyle}"
                      SelectionChanged="CmbSpfGroup_SelectionChanged"/>
        </StackPanel>

        <!-- Параметр ФОП -->
        <StackPanel Grid.Row="2">
            <TextBlock Text="Параметр ФОП" Style="{StaticResource LabelStyle}"/>
            <ComboBox x:Name="cmbParam" Style="{StaticResource ComboStyle}"
                      SelectionChanged="CmbParam_SelectionChanged"
                      IsEditable="True" IsTextSearchEnabled="True"/>
        </StackPanel>

        <!-- Инфо -->
        <Border Grid.Row="3" Background="#EEF2FF" CornerRadius="4"
                Padding="10,6" Margin="0,4,0,0"
                x:Name="pnlParamInfo" Visibility="Collapsed">
            <TextBlock x:Name="txtParamInfo" Style="{StaticResource InfoStyle}" TextWrapping="Wrap"/>
        </Border>

        <!-- Привязка + Группа отображения -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Margin="0,0,24,0">
                <TextBlock Text="Привязка" Style="{StaticResource LabelStyle}"/>
                <StackPanel Orientation="Horizontal">
                    <RadioButton x:Name="rbInstance" Content="Экземпляр"
                                 IsChecked="True" Margin="0,0,16,0" FontSize="12"/>
                    <RadioButton x:Name="rbType" Content="Тип" FontSize="12"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Grid.Column="1">
                <TextBlock Text="Группа отображения" Style="{StaticResource LabelStyle}"/>
                <ComboBox x:Name="cmbDisplayGroup" Style="{StaticResource ComboStyle}" IsEditable="True"/>
            </StackPanel>
        </Grid>

        <!-- Категория + "Вся категория" -->
        <StackPanel Grid.Row="5">
            <TextBlock Text="Категория" Style="{StaticResource LabelStyle}"/>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <ComboBox x:Name="cmbCategory" Grid.Column="0" Style="{StaticResource ComboStyle}"
                          SelectionChanged="CmbCategory_SelectionChanged"/>
                <CheckBox x:Name="chkAllFamilies" Grid.Column="1" Content="Все семейства категории"
                          FontSize="11" VerticalAlignment="Center" Margin="10,0,0,0"
                          Checked="ChkAllFamilies_Changed" Unchecked="ChkAllFamilies_Changed"/>
            </Grid>
        </StackPanel>

        <!-- Список семейств с чекбоксами -->
        <StackPanel Grid.Row="6" Margin="0,4,0,0">
            <TextBlock Text="Семейства" Style="{StaticResource LabelStyle}"/>
            <Border BorderBrush="#CCC" BorderThickness="1" CornerRadius="3"
                    Background="White" MaxHeight="140">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="pnlFamilies"/>
                </ScrollViewer>
            </Border>
        </StackPanel>

        <!-- Связать с параметром семейства -->
        <StackPanel Grid.Row="7">
            <TextBlock Style="{StaticResource LabelStyle}">
                <Run Text="Связать с параметром семейства"/>
                <Run Text="(необязательно)" Foreground="#999" FontWeight="Normal" FontSize="10"/>
            </TextBlock>
            <ComboBox x:Name="cmbLinkParam" Style="{StaticResource ComboStyle}"/>
            <TextBlock Text="Значение общего параметра будет вычисляться формулой из параметра семейства"
                       Style="{StaticResource InfoStyle}" TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Кнопки -->
        <StackPanel Grid.Row="8" Orientation="Horizontal"
                    HorizontalAlignment="Right" Margin="0,12,0,0">
            <TextBlock x:Name="txtStatus" FontSize="11" Foreground="#888"
                       VerticalAlignment="Center" Margin="0,0,16,0"/>
            <Button x:Name="btnAdd" Content="Добавить" Width="120" Height="32"
                    FontSize="12" FontWeight="SemiBold"
                    Background="#2563EB" Foreground="White"
                    BorderThickness="0" Cursor="Hand"
                    Click="BtnAdd_Click" IsEnabled="False">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="4"/>
                    </Style>
                </Button.Resources>
            </Button>
            <Button Content="Закрыть" Width="90" Height="32"
                    FontSize="12" Margin="8,0,0,0"
                    Click="BtnClose_Click">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="4"/>
                    </Style>
                </Button.Resources>
            </Button>
        </StackPanel>
    </Grid>
</Window>
